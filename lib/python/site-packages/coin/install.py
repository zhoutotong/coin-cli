# -*- coding: utf-8 -*-
#ÔºÅ/bin/env python3
import os
import coin.utils
import coin.config
import pip


def install_pypkg(pkg):
    name = pkg['name']
    if 'version' in pkg:
        name = f"{name}=={pkg['version']}"
    pip.main(['install', name])

def install_cpppkg(pkg):
    pass

def install_coinpkg(pkg):
    pass

def install_aptpkg(pkg):
    name = pkg['name']
    if 'cmd' in pkg:
        cmd = pkg['cmd']
        os.system(cmd)
        
    else:
        os.system(f"sudo apt-get install -y {name}")

install_table = {
    'py': install_pypkg,
    'cpp': install_cpppkg,
    'coin': install_coinpkg,
    'apt': install_aptpkg,
}

def install(name):
    config = coin.config.Configration()
    config.load()
    
    num = len(name)
    cnt = 0
    for n in name:
        cnt = cnt + 1
        coin.utils.info(f"installing package {n} [{cnt}/{num}]")
        pkg_info = config.read_package(n)
        if not pkg_info:
            coin.utils.error(f"package {n} not found")
            return
        pkg_type = pkg_info['type']
        if pkg_type not in install_table:
            coin.utils.error(f"package type [{pkg_type}] not supported")
            return

        pkg_info['name'] = n
        install_table[pkg_type](pkg_info)
        
        coin.utils.info(f"package {n} installed")
